# TLS Client

## Общие сведения

Решение построенно с использованием обертки OpenSSL для python PyOpenSSL. Оно может сконструировать HTTP запрос, отправить его поверх TLS протокола и принять ответ. Для использование требуется правильно составленный конфигурационный файл, где прописываются: путь до файла сертификатов в формате PEM, с помощью которого проверяются сертификаты сервера, используемые шифронаборы, путь до клиентского сертификата, который будет использоваться для аутентификации клиента, используемые элиптические кривые, таймаут TLS соединения, путь до файла куда будет логгироваться ключи или флаг, что ключи будут логгироваться в пооток ощибок, флаг, определяющий строгость проверки сертификата, и политика кеширования сессии.

### Проверка сертификатов

Проверка сертификатов производится автоматически на основе указанных сертификатов. Если сервер не прощел проверку, то при использовании строгой проверки сертификатов соединение разрывается. Если путь до сертификатов не указан, будут использованы пути для ОС по-умолчанию (Но работает это плохо, поэтому лучше указывать).

### Поддерживаемые версии

Поддерживаются версии TLSv1.2 и TLSv1.3, которые задаются для конкретного соединения -- при попытке использования других версий выбрасывается ошибка.

### Логгирование ключей

Ключи логируется callback'ом KeyLogger.write при каждой их смене в стандартном формате. Можно логгировать ключи в стандартный поток ошибок для дебага.

### Шифронаборы и эллиптические кривые

Поддерживаются все шифронаборы, которые поддерживает сам OpenSSL, но их количество можно ограничить еще сильнее в конфиге. К тому же для конкретного соединения можно использовать конкретный шифр. Попытка использовать шифры, не указанные в конфиге приведет к ошибке.

### Кеширование сессий

Сессии кэшируются модулем SessionStorage, но только на время пока работает сам клиент, поэтому для их переиспользования требуется делать несколько запросов в рамках одного запуска 

## Установка

1. git clone https://github.com/MLDDLB/tls_client.git path/to/client
2. cd path/to/client
3. pyton3 setup.py install; py setup.py install

## Использование

1. Cоздать конфиг в формате как в примере
2. Во время запуска указать путь до него
3. python3 -m tls_client options

### Опции

1. --host -- Кому отправить сообщение
2. --port -- На какой порт отправить сообщение
3. --config -- путь до конфигурационного файла
4. --version -- Используемая версия TLS
5. --cipher -- Используемый для соединения шифронабор
6. -M -- HTTP метод
7. -H -- HTTP заголовки
8. -D -- Дата для не GET запросов
9. -P -- путь на хосте

### Пример команды

python3 -m tls_client --host example.com --port 443 --version 3 --cipher AES256-GCM-SHA384 -H "Host: example.com" "Connection: keep-alive" "Cache-Control: max-age=0" "Upgrade-Insecure-Requests: 1" "User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 YaBrowser/23.3.3.769 Yowser/2.5 Safari/537.36\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7" "Accept-Encoding: gzip, deflate" "Accept-Language: ru,en;q=0.9,fr;q=0.8" "If-None-Match: 3147526947+gzip"